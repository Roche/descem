<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example for a Sick-Sicker-Dead model • descem</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example for a Sick-Sicker-Dead model">
<meta property="og:description" content="descem">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SGZFXJEC6X"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  
  gtag('config', 'G-SGZFXJEC6X');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">descem</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example_ssd.html">Example in a Sick-Sicker-Dead Model</a>
    </li>
    <li>
      <a href="../articles/example_eBC.html">Example in Early Breast Cancer</a>
    </li>
    <li>
      <a href="../articles/example_markov.html">Example in a Markov Model</a>
    </li>
    <li>
      <a href="../articles/example_uncertainty.html">Structural and Parametric Uncertainty</a>
    </li>
    <li>
      <a href="../articles/example_ipd.html">Example for Individual Patient Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/index.html" class="external-link">Global-HTA-Evidence-Open</a>
    </li>
    <li>
      <a href="https://roche.github.io/flexsurvPlus/index.html" class="external-link">flexsurvPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/gemtcPlus/index.html" class="external-link">gemtcPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/MAIC/index.html" class="external-link">MAIC</a>
    </li>
    <li>
      <a href="https://roche.github.io/rpsftmPlus/index.html" class="external-link">rpsftmPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/descem/index.html" class="external-link">descem</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Roche/descem" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example_ssd_files/kePrint-0.0.1/kePrint.js"></script><link href="example_ssd_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example for a Sick-Sicker-Dead model</h1>
                        <h4 data-toc-skip class="author">Javier Sanchez Alvarez and Valerie Aponte Ribero</h4>
            
            <h4 data-toc-skip class="date">July 26, 2022</h4>
      
      
      <div class="hidden name"><code>example_ssd.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document runs a discrete event simulation model in the context of early breast cancer to show how the functions can be used to generate a model in only a few steps.</p>
<p>When running a DES, it’s important to consider speed. Simulation based models can be computationally expensive, which means that using efficient coding can have a substantial impact on performance. Because the model is using parallel computing, in order to debug the model one can simply use browser() where needed and set the number of patients to be simulated equal to 1.</p>
<div class="section level3">
<h3 id="main-options">Main options<a class="anchor" aria-label="anchor" href="#main-options"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">descem</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/flexsurv-dev" class="external-link">flexsurv</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: survival</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'kableExtra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     group_rows</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>tibble.print_max <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="general-inputs-with-delayed-execution">General inputs with delayed execution<a class="anchor" aria-label="anchor" href="#general-inputs-with-delayed-execution"></a>
</h2>
<p>Initial inputs and flags that will be used in the model can be defined below. We can define inputs that are common to all patients (<code>common_all_inputs</code>) within a simulation, inputs that are unique to a patient independently of the treatment (e.g. natural death, defined in <code>common_pt_inputs</code>), and inputs that are unique to that patient and that treatment (<code>unique_pt_inputs</code>). Items can be included through the <code>add_item</code> function, and can be used in subsequent items. All these inputs are generated before the events and the reaction to events are executed. Furthermore, the program first executes <code>common_all_inputs</code>, then <code>common_pt_inputs</code> and then <code>unique_pt_inputs</code>. So one could use the items generated in <code>common_all_inputs</code> in <code>unique_pt_inputs</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Each patient is identified through "i"</span></span>
<span><span class="co">#psa_bool is the indicator of whether we want to apply a PSA or not</span></span>
<span></span>
<span><span class="co">#Put objects here that do not change on any patient or intervention loop</span></span>
<span><span class="va">common_all_inputs</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span></span>
<span>                      util.sick <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                      util.sicker <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                      cost.sick <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>                      cost.sicker <span class="op">=</span> <span class="fl">7000</span>,</span>
<span>                      cost.int <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                      coef_noint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                      HR_int <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#Put objects here that do not change as we loop through treatments for a patient</span></span>
<span><span class="va">common_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>death<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">0.0000001</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, mean<span class="op">=</span><span class="fl">12</span>, sd<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#Put objects here that change as we loop through treatments for each patient (e.g. events can affect fl.tx, but events do not affect nat.os.s)</span></span>
<span><span class="va">unique_pt_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_item.html">add_item</a></span><span class="op">(</span>fl.sick <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="events">Events<a class="anchor" aria-label="anchor" href="#events"></a>
</h2>
<div class="section level3">
<h3 id="add-initial-events">Add Initial Events<a class="anchor" aria-label="anchor" href="#add-initial-events"></a>
</h3>
<p>Events are added below through the <code>add_tte</code> function. We use this function twice, one per intervention. We must define several arguments: one to indicate the intervention, one to define the names of the events used, one to define the names of other objects created that we would like to store (optional, maybe we generate an intermediate input which is not an event but that we want to save) and the actual input in which we generate the time to event. Events and other objects will be automatically initialized to <code>Inf</code>. We draw the times to event for the patients. This chunk is a bit more complex, so it’s worth spending a bit of time explaining it.</p>
<p>The <code>init_event_list</code> object is populated by using the <code>add_tte</code> function twice, one for the “int” strategy and other for the “noint” strategy. We first declare the <code>start</code> time to be <code>0</code>.</p>
<p>We then proceed to generate the actual time to event. We use the <code><a href="../reference/draw_tte.html">draw_tte()</a></code> function to generate the time to event. One should always be aware of how the competing risks interact with each other. While we have abstracted from these type of corrections here, it is recommended to have an understanding about how these affect the results and have a look at the competing risks/semi-competing risks literature.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">init_event_list</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/add_tte.html">add_tte</a></span><span class="op">(</span>trt<span class="op">=</span><span class="st">"noint"</span>, evts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sick"</span>,<span class="st">"sicker"</span>,<span class="st">"death"</span><span class="op">)</span> ,input<span class="op">=</span><span class="op">{</span> <span class="co">#intervention</span></span>
<span>    <span class="va">sick</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">sicker</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,dist<span class="op">=</span><span class="st">"exp"</span>, coef1<span class="op">=</span><span class="va">coef_noint</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="../reference/add_tte.html">add_tte</a></span><span class="op">(</span>trt<span class="op">=</span><span class="st">"int"</span>, evts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sick"</span>,<span class="st">"sicker"</span>,<span class="st">"death"</span><span class="op">)</span> ,input<span class="op">=</span><span class="op">{</span>  </span>
<span>    <span class="va">sick</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">sicker</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_tte.html">draw_tte</a></span><span class="op">(</span><span class="fl">1</span>,dist<span class="op">=</span><span class="st">"exp"</span>, coef1<span class="op">=</span><span class="va">coef_noint</span>, hr <span class="op">=</span> <span class="va">HR_int</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="add-reaction-to-those-events">Add Reaction to Those Events<a class="anchor" aria-label="anchor" href="#add-reaction-to-those-events"></a>
</h3>
<p>Once the initial times of the events have been defined, we also need to declare how events react and affect each other. To do so, we use the <code>evt_react_list</code> object and the <code>add_reactevt</code> function. This function just needs to state which event is affected, and the actual reaction (usually setting flags to 1 or 0, or creating new/adjusting events).</p>
<p>There are a series of objects that can be used in this context to help with the reactions. Apart from the global objects and flags defined above, we can also use <code>curtime</code> for the current event time, <code>prevtime</code> for the time of the previous event, <code>cur_evtlist</code> for the named vector of events that is yet to happen for that patient, <code>trt</code> for the current treatment in the loop, <code>evt</code> for the current event being processed, <code>i</code> expresses the patient iteration, and <code>simulation</code> the specific simulation (relevant when the number of simulations is greater than 1). Furthermore, one can also call any other input/item that has been created before or create new ones. For example, we could even modify a cost/utility item by changing it directly, e.g. through <code>modify_item(list(cost.idfs.tx=500))</code>.</p>
<table class="table">
<colgroup>
<col width="48%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th>Item</th>
<th>What does it do</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>curtime</code></td>
<td>Current event time (numeric)</td>
</tr>
<tr class="even">
<td><code>prevtime</code></td>
<td>Time of the previous event (numeric)</td>
</tr>
<tr class="odd">
<td><code>cur_evtlist</code></td>
<td>Named vector of events that is yet to happen for that patient (named numeric vector)</td>
</tr>
<tr class="even">
<td><code>evt</code></td>
<td>Current event being processed (character)</td>
</tr>
<tr class="odd">
<td><code>i</code></td>
<td>Patient being iterated (character)</td>
</tr>
<tr class="even">
<td><code>simulation</code></td>
<td>Simulation being iterated (numeric)</td>
</tr>
</tbody>
</table>
<p>The functions to add/modify events and inputs use lists. Whenever several inputs/events are added or modified, it’s recommended to group them within one function, as it reduces the computation cost. So rather than use two <code>modify_item</code> with a list of one element, it’s better to group them into a single <code>modify_item</code> with a list of two elements.</p>
<p><code>new_event</code>allows to generate events and add them to the vector of events. It accepts more than one event. <code>modify_event</code> allows to modify events (e.g. delay death). When adding an event, the name of the events and the time of the events must be defined. When using <code>modify_event</code>, one must indicate which events are affected and what are the new times of the events. If the event specified does not exist or has already occurred, it will be ignored. Note that one could potentially omit part of the modeling set in <code>init_event_list</code> and actually define new events dynamically through the reactions (we do that below for the <code>"ae"</code> event). However, this can have an impact in computation time, so if possible it’s always better to use <code>init_event_list</code>. <code>modify_item</code> allows to modify and add items. Elements defined within this function are not evaluated sequentially (i.e. defining <code>modify_item(list(fl.new = 1, var1 = fl.new * 5)))</code> will give an error if <code>fl.new</code> was not defined outside this function).</p>
<p>The list of relevant functions to be used within <code>add_reactevt</code> are:</p>
<table class="table">
<colgroup>
<col width="31%">
<col width="34%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>What does it do</th>
<th>How to use it</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/modify_item.html">modify_item()</a></code></td>
<td>Adds &amp; Modifies items/flags/variables for future events</td>
<td><code>modify_item(list("fl.idfs.ontx"=0,"fl.tx.beva"=0))</code></td>
</tr>
<tr class="even">
<td><code><a href="../reference/new_event.html">new_event()</a></code></td>
<td>Adds events to the vector of events for that patient</td>
<td><code>new_event(rep(list("ae"=curtime + 0.001),5))</code></td>
</tr>
<tr class="odd">
<td><code><a href="../reference/modify_event.html">modify_event()</a></code></td>
<td>Modifies existing events by changing their time</td>
<td><code>modify_event(list("os"=curtime +5, "ttot"=curtime+0.0001))</code></td>
</tr>
</tbody>
</table>
<p>The model will run until <code>curtime</code> is set to <code>Inf</code>, so the event that terminates the model (in this case, <code>os</code>), should modify <code>curtime</code> and set it to <code>Inf</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evt_react_list</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"sick"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"sicker"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fl.sick <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span>
<span>               <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_reactevt.html">add_reactevt</a></span><span class="op">(</span>name_evt <span class="op">=</span> <span class="st">"death"</span>,</span>
<span>               input <span class="op">=</span> <span class="op">{</span></span>
<span>                 <span class="fu"><a href="../reference/modify_item.html">modify_item</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>curtime <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span> </span>
<span>               <span class="op">}</span><span class="op">)</span> </span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="costs-and-utilities">Costs and Utilities<a class="anchor" aria-label="anchor" href="#costs-and-utilities"></a>
</h2>
<p>Costs and utilities are introduced below. However, it’s worth noting that the model is able to run without costs or utilities.</p>
<div class="section level3">
<h3 id="utilities">Utilities<a class="anchor" aria-label="anchor" href="#utilities"></a>
</h3>
<p>Utilities are defined using pipes with the <code>add_util</code> function. The first argument says which events are affected, the second argument which treatments are affected, and the third one describe the utilities. Instant utilities (e.g. AE disutilities) and cycle utilities can be defined in a similar fashion. Note that one can write expressions and objects whose execution will be delayed until the model runs.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">util_ongoing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_util.html">add_util</a></span><span class="op">(</span>evt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sick"</span>, <span class="st">"sicker"</span>,<span class="st">"death"</span><span class="op">)</span>,</span>
<span>                              trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,</span>
<span>                              util <span class="op">=</span> <span class="va">util.sick</span> <span class="op">*</span> <span class="va">fl.sick</span> <span class="op">+</span> <span class="va">util.sicker</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.sick</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="costs">Costs<a class="anchor" aria-label="anchor" href="#costs"></a>
</h3>
<p>Costs are defined using pipes with the <code>add_cost</code> function, in a similar fashion to the utilities.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cost_ongoing</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/add_cost.html">add_cost</a></span><span class="op">(</span></span>
<span>    evt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sick"</span>, <span class="st">"sicker"</span>,<span class="st">"death"</span><span class="op">)</span> ,</span>
<span>    trt <span class="op">=</span> <span class="st">"noint"</span>,</span>
<span>    cost <span class="op">=</span> <span class="va">cost.sick</span> <span class="op">*</span> <span class="va">fl.sick</span> <span class="op">+</span> <span class="va">cost.sicker</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.sick</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_cost.html">add_cost</a></span><span class="op">(</span></span>
<span>    evt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sick"</span>, <span class="st">"sicker"</span>,<span class="st">"death"</span><span class="op">)</span> ,</span>
<span>    trt <span class="op">=</span> <span class="st">"int"</span>,</span>
<span>    cost <span class="op">=</span> <span class="va">cost.sick</span> <span class="op">*</span> <span class="va">fl.sick</span> <span class="op">+</span> <span class="va">cost.sicker</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">fl.sick</span><span class="op">)</span> <span class="op">+</span> <span class="va">cost.int</span> <span class="op">*</span> <span class="va">fl.sick</span> <span class="op">)</span> </span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<div class="section level3">
<h3 id="model-execution">Model Execution<a class="anchor" aria-label="anchor" href="#model-execution"></a>
</h3>
<p>The model can be run using the function <code>RunSim</code> below. We must define the number of patients to be simulated, the number of simulations, whether we want to run a PSA or not, the strategy list, the inputs, events and reactions defined above, the number of cores to be used (by default uses 1 core), the discount rate for costs and the discount rate for qalys. It is recommended not to use all the cores in the machine.</p>
<p>It is worth noting that the <code>psa_bool</code> argument does not run a PSA automatically, but is rather an additional input/flag of the model that we use as a reference to determine whether we want to use a deterministic or stochastic input. As such, it could also be defined in <code>common_all_inputs</code> as the first item to be defined, and the result would be the same. However, we recommend it to be defined in <code>RunSim</code>.</p>
<p>Note that the distribution chosen, the number of events and the interaction between events can have a substantial impact on the running time of the model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Logic is: per patient, per intervention, per event, react to that event.</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunSim.html">RunSim</a></span><span class="op">(</span>  </span>
<span>  npats<span class="op">=</span><span class="fl">1000</span>,                               <span class="co"># number of patients to be simulated</span></span>
<span>  n_sim<span class="op">=</span><span class="fl">1</span>,                                  <span class="co"># number of simulations to run</span></span>
<span>  psa_bool <span class="op">=</span> <span class="cn">FALSE</span>,                         <span class="co"># use PSA or not. If n_sim &gt; 1 and psa_bool = FALSE, then difference in outcomes is due to sampling (number of pats simulated)  </span></span>
<span>  trt_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>, <span class="st">"noint"</span><span class="op">)</span>,             <span class="co"># intervention list</span></span>
<span>  common_all_inputs <span class="op">=</span> <span class="va">common_all_inputs</span>,    <span class="co"># inputs common that do not change within a simulation</span></span>
<span>  common_pt_inputs <span class="op">=</span> <span class="va">common_pt_inputs</span>,      <span class="co"># inputs that change within a simulation but are not affected by the intervention</span></span>
<span>  unique_pt_inputs <span class="op">=</span> <span class="va">unique_pt_inputs</span>,      <span class="co"># inputs that change within a simulation between interventions</span></span>
<span>  init_event_list <span class="op">=</span> <span class="va">init_event_list</span>,        <span class="co"># initial event list</span></span>
<span>  evt_react_list <span class="op">=</span> <span class="va">evt_react_list</span>,          <span class="co"># reaction of events</span></span>
<span>  util_ongoing_list <span class="op">=</span> <span class="va">util_ongoing</span>,</span>
<span>  cost_ongoing_list <span class="op">=</span> <span class="va">cost_ongoing</span>,</span>
<span>  ncores <span class="op">=</span> <span class="fl">2</span>,                               <span class="co"># number of cores to use, recommended not to use all</span></span>
<span>  drc <span class="op">=</span> <span class="fl">0.035</span>,                              <span class="co"># discount rate for costs</span></span>
<span>  drq <span class="op">=</span> <span class="fl">0.035</span>                               <span class="co"># discount rate for qaly/lys</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Simulation number: 1"</span></span>
<span><span class="co">#&gt; [1] "Time to run iteration 1: 2.33s"</span></span>
<span><span class="co">#&gt; [1] "Total time to run: 2.33s"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="post-processing-of-model-outputs">Post-processing of Model Outputs<a class="anchor" aria-label="anchor" href="#post-processing-of-model-outputs"></a>
</h2>
<div class="section level3">
<h3 id="summary-of-results">Summary of Results<a class="anchor" aria-label="anchor" href="#summary-of-results"></a>
</h3>
<p>Once the model has been run, we can use the results and summarize them using the <code>summary_results_det</code> to print the results of the last simulation (if nsim=1, it’s the deterministic case), and <code>summary_results_psa</code> to show the PSA results (with the confidence intervals). We can also use the individual patient data generated by the simulation, which we collect here to plot in the <code>psa_ipd</code> object.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="../reference/summary_results_det.html">summary_results_det</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">final_output</span><span class="op">)</span> <span class="co">#will print the last simulation!</span></span>
<span><span class="co">#&gt;            int    noint</span></span>
<span><span class="co">#&gt; costs 55369.21 53111.12</span></span>
<span><span class="co">#&gt; lys       9.78     9.78</span></span>
<span><span class="co">#&gt; qalys     6.19     6.04</span></span>
<span><span class="co">#&gt; ICER        NA      Inf</span></span>
<span><span class="co">#&gt; ICUR        NA 14367.43</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summary_results_psa.html">summary_results_psa</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span><span class="op">)</span></span>
<span><span class="co">#&gt;                       int               noint</span></span>
<span><span class="co">#&gt; costs 55369(55369, 55369) 53111(53111, 53111)</span></span>
<span><span class="co">#&gt; lys      9.78(9.78, 9.78)    9.78(9.78, 9.78)</span></span>
<span><span class="co">#&gt; qalys    6.19(6.19, 6.19)    6.04(6.04, 6.04)</span></span>
<span><span class="co">#&gt; ICER          NaN(NA, NA)       Inf(Inf, Inf)</span></span>
<span><span class="co">#&gt; ICUR          NaN(NA, NA) 14367(14367, 14367)</span></span>
<span></span>
<span><span class="va">psa_ipd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">output_psa</span>, <span class="st">"merged_df"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">psa_ipd</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
evtname
</th>
<th style="text-align:right;">
evttime
</th>
<th style="text-align:right;">
cost
</th>
<th style="text-align:right;">
qaly
</th>
<th style="text-align:right;">
ly
</th>
<th style="text-align:right;">
pat_id
</th>
<th style="text-align:left;">
trt
</th>
<th style="text-align:right;">
total_costs
</th>
<th style="text-align:right;">
total_qalys
</th>
<th style="text-align:right;">
total_lys
</th>
<th style="text-align:right;">
simulation
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
sick
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
73626.16
</td>
<td style="text-align:right;">
5.475675
</td>
<td style="text-align:right;">
10.698576
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sicker
</td>
<td style="text-align:right;">
0.4243738
</td>
<td style="text-align:right;">
1685.164
</td>
<td style="text-align:right;">
0.3370329
</td>
<td style="text-align:right;">
0.4212911
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
73626.16
</td>
<td style="text-align:right;">
5.475675
</td>
<td style="text-align:right;">
10.698576
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
death
</td>
<td style="text-align:right;">
13.3406999
</td>
<td style="text-align:right;">
71940.994
</td>
<td style="text-align:right;">
5.1386424
</td>
<td style="text-align:right;">
10.2772848
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
73626.16
</td>
<td style="text-align:right;">
5.475675
</td>
<td style="text-align:right;">
10.698576
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sick
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
33429.94
</td>
<td style="text-align:right;">
4.655493
</td>
<td style="text-align:right;">
6.665406
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sicker
</td>
<td style="text-align:right;">
4.7819160
</td>
<td style="text-align:right;">
17637.206
</td>
<td style="text-align:right;">
3.5274411
</td>
<td style="text-align:right;">
4.4093014
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
33429.94
</td>
<td style="text-align:right;">
4.655493
</td>
<td style="text-align:right;">
6.665406
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
death
</td>
<td style="text-align:right;">
7.5710636
</td>
<td style="text-align:right;">
15792.730
</td>
<td style="text-align:right;">
1.1280521
</td>
<td style="text-align:right;">
2.2561043
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
33429.94
</td>
<td style="text-align:right;">
4.655493
</td>
<td style="text-align:right;">
6.665406
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sick
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
77087.01
</td>
<td style="text-align:right;">
6.584838
</td>
<td style="text-align:right;">
11.911283
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sicker
</td>
<td style="text-align:right;">
2.1768321
</td>
<td style="text-align:right;">
8389.288
</td>
<td style="text-align:right;">
1.6778575
</td>
<td style="text-align:right;">
2.0973219
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
77087.01
</td>
<td style="text-align:right;">
6.584838
</td>
<td style="text-align:right;">
11.911283
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
death
</td>
<td style="text-align:right;">
15.3259546
</td>
<td style="text-align:right;">
68697.724
</td>
<td style="text-align:right;">
4.9069803
</td>
<td style="text-align:right;">
9.8139605
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
77087.01
</td>
<td style="text-align:right;">
6.584838
</td>
<td style="text-align:right;">
11.911283
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sick
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
int
</td>
<td style="text-align:right;">
41007.00
</td>
<td style="text-align:right;">
8.201399
</td>
<td style="text-align:right;">
10.251749
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>We can also check what has been the absolute number of events per strategy.</p>
<table class="table table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
trt
</th>
<th style="text-align:left;">
evtname
</th>
<th style="text-align:right;">
n
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
death
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
sick
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:left;">
int
</td>
<td style="text-align:left;">
sicker
</td>
<td style="text-align:right;">
847
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
death
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
sick
</td>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:left;">
noint
</td>
<td style="text-align:left;">
sicker
</td>
<td style="text-align:right;">
906
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="plots">Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h3>
<p>We now use the data output to plot the histograms/densities of the simulation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_plot</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">final_output</span><span class="op">$</span><span class="va">merged_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">evtname</span> <span class="op">!=</span> <span class="st">"sick"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">trt</span>,<span class="va">evtname</span>,<span class="va">simulation</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">evttime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">trt</span>, x <span class="op">=</span> <span class="va">evttime</span><span class="op">)</span>,</span>
<span>               alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">median</span>,col<span class="op">=</span><span class="va">trt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">evtname</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_ssd_files/figure-html/post-processing_plots1-1.png" width="960"></p>
<p>We can also plot the patient level incremental QALY/costs. Note that there are several clusters in the distribution of patients according to their QALY/costs based on the pathway they took (early metastatic vs. remission and cure or recurrence).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_qaly_cost</span><span class="op">&lt;-</span> <span class="va">psa_ipd</span><span class="op">[</span>,<span class="va">.SD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">pat_id</span>,<span class="va">trt</span>,<span class="va">simulation</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">trt</span>,qaly<span class="op">=</span><span class="va">total_qalys</span>,cost<span class="op">=</span><span class="va">total_costs</span>,<span class="va">pat_id</span>,<span class="va">simulation</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">data_qaly_cost</span><span class="op">[</span>,<span class="va">ps_id</span><span class="op">:=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">pat_id</span>,<span class="va">simulation</span>,sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">mean_data_qaly_cost</span> <span class="op">&lt;-</span> <span class="va">data_qaly_cost</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_qaly_cost</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">qaly</span>, y <span class="op">=</span> <span class="va">cost</span>, col <span class="op">=</span> <span class="va">trt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.15</span>,shape <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mean_data_qaly_cost</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">qaly</span>, y <span class="op">=</span> <span class="va">cost</span>, fill <span class="op">=</span> <span class="va">trt</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span>,col<span class="op">=</span><span class="st">"black"</span>,size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_ssd_files/figure-html/post-processing_plots-1.png" width="960"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Valerie Aponte Ribero, Javier Sanchez Alvarez.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
